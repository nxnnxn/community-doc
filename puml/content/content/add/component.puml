@startuml
!include <C4/C4_Component>
LAYOUT_WITH_LEGEND()

Person(user, "用户")
Person(user1, "运营")
Person(user2, "安检")

System_Boundary(contentProduction, "内容生产"){
    Container_Boundary(postBoundary, "帖子") {
          Container(postFacade, "帖子前台应用","Spring-boot")
          Container(postService, "帖子服务应用","Spring-boot")
          Container(postJob, "帖子任务应用","Spring-boot")
          ContainerDb(postDatabase, "帖子数据库", "Mysql")
          ContainerQueue(postQueue, "帖子队列", "RocketMq")
          Rel(postFacade, postService, "调用")
          Rel_U(postService, postDatabase, "调用")
          Rel_U(postJob, postDatabase, "调用")
          Rel_R(postService,postQueue, "发送")
          BiRel_R(postQueue,postJob, "消息接收&任务")
    }
     Container_Boundary(transcodeBoundary, "转码") {
           Container(transcode, "转码系统","Spring-boot")
     }
    Container_Boundary(postToolBoundary, "工具") {
         Container(postTool, "生产工具系统","Spring-boot")
    }
    Rel_L(postService, transcode, "调用")

}

System_Ext(security,"安全系统")
System_Ext(userSystem,"用户系统")
System_Ext(community, "社区系统")
System_Ext(audit, "审核系统")
System_Ext(message, "消息系统")
System_Ext(play, "播放系统")


Rel(user, postFacade, "发帖")
Rel(user, postTool, "生产工具")
Rel(user1,contentProduction, "运营")

Rel(contentProduction, security, "安全规则")
Rel(postService, userSystem, "用户认证&权限")
Rel(postService, community, "获取社区信息")
Rel(postJob, message, "发布消息")
Rel(postJob, audit, "发起审核")
Rel_U(play, postService, "获取地址")
Rel_U(user2, audit, "审核")



LAYOUT_WITH_LEGEND()

title Component diagram for Internet Banking System - API Application

Container(spa, "Single Page Application", "javascript and angular", "Provides all the internet banking functionality to customers via their web browser.")
Container(ma, "Mobile App", "Xamarin", "Provides a limited subset ot the internet banking functionality to customers via their mobile mobile device.")
ContainerDb(db, "Database", "Relational Database Schema", "Stores user registration information, hashed authentication credentials, access logs, etc.")
System_Ext(mbs, "Mainframe Banking System", "Stores all of the core banking information about customers, accounts, transactions, etc.")

Container_Boundary(api, "API Application") {
    Component(sign, "Sign In Controller", "MVC Rest Controller", "Allows users to sign in to the internet banking system")
    Component(accounts, "Accounts Summary Controller", "MVC Rest Controller", "Provides customers with a summary of their bank accounts")
    Component(security, "Security Component", "Spring Bean", "Provides functionality related to singing in, changing passwords, etc.")
    Component(mbsfacade, "Mainframe Banking System Facade", "Spring Bean", "A facade onto the mainframe banking system.")

    Rel(sign, security, "Uses")
    Rel(accounts, mbsfacade, "Uses")
    Rel(security, db, "Read & write to", "JDBC")
    Rel(mbsfacade, mbs, "Uses", "XML/HTTPS")
}

Rel(spa, sign, "Uses", "JSON/HTTPS")
Rel(spa, accounts, "Uses", "JSON/HTTPS")

Rel(ma, sign, "Uses", "JSON/HTTPS")
Rel(ma, accounts, "Uses", "JSON/HTTPS")

@enduml